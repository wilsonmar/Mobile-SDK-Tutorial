<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>README.html</title>
  <meta name="generator" content="Haroopad 0.13.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.edgePath .path{stroke:green;stroke-width:1.5px}.cluster rect{fill:#cdffb2;rx:40;stroke:#6eaa49;stroke-width:1px}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}text{font-family:'trebuchet ms',verdana,arial;font-size:14px}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre;margin:0}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}@import url(http://fonts.googleapis.com/css?family=Roboto+Condensed:300italic,400italic,700italic,400,300,700);.haroopad{padding:20px;color:#222;font-size:15px;font-family:"Roboto Condensed",Tauri,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.haroopad a{color:#3269a0}.haroopad a:hover{color:#4183c4}.haroopad h2{border-bottom:1px solid #e6e6e6}.haroopad h6{color:#777}.haroopad hr{border:1px solid #e6e6e6}.haroopad blockquote>code,.haroopad h1>code,.haroopad h2>code,.haroopad h3>code,.haroopad h4>code,.haroopad h5>code,.haroopad h6>code,.haroopad li>code,.haroopad p>code,.haroopad td>code{font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;background-color:rgba(0,0,0,.02);padding:.2em .5em;border:1px solid #efefef}.haroopad pre>code{font-size:1em;letter-spacing:-1px;font-weight:700}.haroopad blockquote{border-left:4px solid #e6e6e6;padding:0 15px;color:#777}.haroopad table{background-color:#fafafa}.haroopad table tr td,.haroopad table tr th{border:1px solid #e6e6e6}.haroopad table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;overflow-x:auto;padding:.5em;background:#fdf6e3;color:#657b83;-webkit-text-size-adjust:none}.diff .hljs-header,.hljs-comment,.hljs-doctype,.hljs-javadoc,.hljs-pi,.lisp .hljs-string{color:#93a1a1}.css .hljs-tag,.hljs-addition,.hljs-keyword,.hljs-request,.hljs-status,.hljs-winutils,.method,.nginx .hljs-title{color:#859900}.hljs-command,.hljs-dartdoc,.hljs-hexcolor,.hljs-link_url,.hljs-number,.hljs-phpdoc,.hljs-regexp,.hljs-rules .hljs-value,.hljs-string,.hljs-tag .hljs-value,.tex .hljs-formula{color:#2aa198}.css .hljs-function,.hljs-built_in,.hljs-chunk,.hljs-decorator,.hljs-id,.hljs-identifier,.hljs-localvars,.hljs-title,.vhdl .hljs-literal{color:#268bd2}.hljs-attribute,.hljs-class .hljs-title,.hljs-constant,.hljs-link_reference,.hljs-parent,.hljs-type,.hljs-variable,.lisp .hljs-body,.smalltalk .hljs-number{color:#b58900}.css .hljs-pseudo,.diff .hljs-change,.hljs-attr_selector,.hljs-cdata,.hljs-header,.hljs-pragma,.hljs-preprocessor,.hljs-preprocessor .hljs-keyword,.hljs-shebang,.hljs-special,.hljs-subst,.hljs-symbol,.hljs-symbol .hljs-string{color:#cb4b16}.hljs-deletion,.hljs-important{color:#dc322f}.hljs-link_label{color:#6c71c4}.tex .hljs-formula{background:#eee8d5}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Hover_Arrow{position:absolute;width:15px;height:11px;cursor:pointer}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:5px 0;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;-khtml-border-radius:5px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:1px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;color:#666}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:.7em}.MathJax_MenuRadioCheck.RTL{right:.7em;left:auto}.MathJax_MenuLabel{padding:1px 2em 3px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #DDD;margin:4px 3px}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:#606872;color:#fff}.MathJax_Menu_Close{position:absolute;width:31px;height:31px;top:-15px;left:-15px}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1px;bottom:2px;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown haroopad">
<h1 id="creating-a-camera-application"><a name="creating-a-camera-application" href="#creating-a-camera-application"></a>Creating a Camera Application</h1><p><em>If you come across any mistakes or bugs in this tutorial, please let us know using a Github issue or a post on the DJI forum, or commenting in the Gitbook. Please feel free to send us Github pull request and help us fix any issues. However, all pull requests related to document must follow the <a href="https://github.com/dji-sdk/Mobile-SDK-Tutorial/issues/19">document style</a></em></p><hr class="section"><p>This tutorial uses Phantom 3 Professional as an example.<br>You can download the final project for this tutorial from this Github page.<br>We <strong>strongly</strong> recommend that you download the final project code and have it open as reference as you work through this tutorial.</p><h2 id="preparation"><a name="preparation" href="#preparation"></a>Preparation</h2><p>(1) Download the Mobile SDK for Android from the following URL:<br><a href="https://developer.dji.com/mobile-sdk/downloads">https://developer.dji.com/mobile-sdk/downloads</a></p><p>(2) Update the firmware of the product (Phantom 3 Series, Inspire 1, Inspire Pro, M100, OSMO) through the URL: <a href="https://developer.dji.com/mobile-sdk/downloads/">https://developer.dji.com/mobile-sdk/downloads/</a> (<em>Refer to “How to Update the Firmware”: <a href="http://www.dji.com/product/phantom-3-pro/info#downloads">http://www.dji.com/product/phantom-3-pro/info#downloads</a> for instructions on updating the Phantom 3 Professional’s firmware.</em>)</p><p>(3) Set up an Android development environment (if you do not yet have one). Throughout this tutorial we will be using Android Studio 1.5.1, which you can download here: <a href="http://developer.android.com/sdk/index.html">http://developer.android.com/sdk/index.html</a>.</p><h2 id="setting-up-your-programming-environment"><a name="setting-up-your-programming-environment" href="#setting-up-your-programming-environment"></a>Setting up your Programming Environment</h2><h3 id="android-studio"><a name="android-studio" href="#android-studio"></a>Android Studio</h3><p>(1) Start a new Android Studio Project. Give the application and company domain any name you like, click next. Set the minimum SDK version as API 19 (recommended) and click next. Select “Empty Activity” and click next. As you reach the ‘Customize the Activity’ page, you should name your activity ‘FPVTutorialActivity’. The layout name should automatically fill out with ‘activity_fpvtutorial’. Press ‘Finish’.</p><p>(2) Unzip the SDK package downloaded from the DJI website. Go to File -&gt; New -&gt; Import Module. In the ‘Source Directory’ field, find the DJI-SDK-LIB folder location. Press Finish.</p><p><img src="Images/importModule.png" alt="importModule"></p><p>(3) Next, right click on the ‘app’ module in the file directory to the left, and click ‘Open Module Settings’. Navigate to the ‘Dependencies’ tab. Press the green plus sign, click ‘Module Dependency’, and select ‘:DJI-SDK-LIB’. Press ‘OK’ to confirm. After Gradle finishes rebuilding, your environment will be ready!</p><p><img src="Images/addDependencyScreenshot.png" alt="addDependency"></p><h2 id="configure-the-project's-androidmanifest-file"><a name="configure-the-project's-androidmanifest-file" href="#configure-the-project's-androidmanifest-file"></a>Configure the Project’s AndroidManifest File</h2><p>You need to configure your project’s AndroidManifest file by adding the following permissions and features for DJI SDK V3.</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>
&amp;lt;!-- DJI SDK permissions --&amp;gt;

&amp;lt;uses-permission android:name=&quot;android.permission.VIBRATE&quot; /&amp;gt;
&amp;lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&amp;gt;
&amp;lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot; /&amp;gt;
&amp;lt;uses-permission android:name=&quot;android.permission.WAKE_LOCK&quot; /&amp;gt;
&amp;lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; /&amp;gt;
&amp;lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&amp;gt;
&amp;lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot; /&amp;gt;
&amp;lt;uses-permission android:name=&quot;android.permission.CHANGE_WIFI_STATE&quot; /&amp;gt;
&amp;lt;uses-permission android:name=&quot;android.permission.MOUNT_UNMOUNT_FILESYSTEMS&quot; /&amp;gt;
&amp;lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&amp;gt;
&amp;lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot; /&amp;gt;
&amp;lt;uses-permission android:name=&quot;android.permission.SYSTEM_ALERT_WINDOW&quot; /&amp;gt;
&amp;lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot; /&amp;gt;
&amp;lt;uses-feature android:name=&quot;android.hardware.camera&quot; /&amp;gt;
&amp;lt;uses-feature android:name=&quot;android.hardware.camera.autofocus&quot; /&amp;gt;
&amp;lt;uses-feature
    android:name=&quot;android.hardware.usb.host&quot;
    android:required=&quot;false&quot; /&amp;gt;
&amp;lt;uses-feature
    android:name=&quot;android.hardware.usb.accessory&quot;
    android:required=&quot;true&quot; /&amp;gt;
&amp;lt;!-- DJI SDK --&amp;gt;
</code></pre>">
<span class="hljs-comment">&lt;!-- DJI SDK permissions --&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.VIBRATE"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.INTERNET"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.ACCESS_WIFI_STATE"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.WAKE_LOCK"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.ACCESS_COARSE_LOCATION"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.ACCESS_FINE_LOCATION"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.CHANGE_WIFI_STATE"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.MOUNT_UNMOUNT_FILESYSTEMS"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.WRITE_EXTERNAL_STORAGE"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.READ_EXTERNAL_STORAGE"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.SYSTEM_ALERT_WINDOW"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.READ_PHONE_STATE"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-feature</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.hardware.camera"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-feature</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.hardware.camera.autofocus"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-feature</span>
    <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.hardware.usb.host"</span>
    <span class="hljs-attribute">android:required</span>=<span class="hljs-value">"false"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">uses-feature</span>
    <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.hardware.usb.accessory"</span>
    <span class="hljs-attribute">android:required</span>=<span class="hljs-value">"true"</span> /&gt;</span>
<span class="hljs-comment">&lt;!-- DJI SDK --&gt;</span>
</code></pre><p>DJI SDK V3 uses USB Accessory method to connect a Remote Controller with a mobile device. Please add the following codes under tag <strong>application</strong> to support this feature, especially pay attention to tag <strong><uses-library></uses-library></strong>, and <strong>intent-filter</strong>, <strong><meta-data></meta-data></strong> within the tag <strong>activity</strong> for <strong>dji.sdk.SDKManager.DJIAoaControllerActivity</strong>.</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>
    &amp;lt;application
        android:name=&quot;com.dji.fpvtutorial.FPVTutorialApplication&quot;
        android:allowBackup=&quot;true&quot;
        android:icon=&quot;@mipmap/ic_launcher&quot;
        android:label=&quot;@string/app_name&quot;
        android:supportsRtl=&quot;true&quot;
        android:theme=&quot;@style/AppTheme&quot;&amp;gt;
        &amp;lt;!-- DJI SDK API Key--&amp;gt;
        &amp;lt;uses-library android:name=&quot;com.android.future.usb.accessory&quot; /&amp;gt;
        &amp;lt;meta-data
            android:name=&quot;com.dji.sdk.API_KEY&quot;
            android:value=&quot;&quot; /&amp;gt;
        &amp;lt;activity
            android:name=&quot;dji.sdk.SDKManager.DJIAoaControllerActivity&quot;
            android:theme=&quot;@android:style/Theme.Translucent&quot; &amp;gt;
            &amp;lt;intent-filter&amp;gt;
                &amp;lt;action android:name=&quot;android.hardware.usb.action.USB_ACCESSORY_ATTACHED&quot; /&amp;gt;
            &amp;lt;/intent-filter&amp;gt;
            &amp;lt;meta-data
                android:name=&quot;android.hardware.usb.action.USB_ACCESSORY_ATTACHED&quot;
                android:resource=&quot;@xml/accessory_filter&quot; /&amp;gt;
        &amp;lt;/activity&amp;gt;
        &amp;lt;!-- DJI SDK --&amp;gt;
        &amp;lt;activity android:name=&quot;.FPVTutorialActivity&quot;
            android:theme=&quot;@android:style/Theme.NoTitleBar.Fullscreen&quot;&amp;gt;
            &amp;lt;intent-filter&amp;gt;
                &amp;lt;action android:name=&quot;android.intent.action.MAIN&quot; /&amp;gt;
                &amp;lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&amp;gt;
            &amp;lt;/intent-filter&amp;gt;
        &amp;lt;/activity&amp;gt;
    &amp;lt;/application&amp;gt;
</code></pre>">
    <span class="hljs-tag">&lt;<span class="hljs-title">application</span>
        <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"com.dji.fpvtutorial.FPVTutorialApplication"</span>
        <span class="hljs-attribute">android:allowBackup</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:icon</span>=<span class="hljs-value">"@mipmap/ic_launcher"</span>
        <span class="hljs-attribute">android:label</span>=<span class="hljs-value">"@string/app_name"</span>
        <span class="hljs-attribute">android:supportsRtl</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:theme</span>=<span class="hljs-value">"@style/AppTheme"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- DJI SDK API Key--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">uses-library</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"com.android.future.usb.accessory"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">meta-data</span>
            <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"com.dji.sdk.API_KEY"</span>
            <span class="hljs-attribute">android:value</span>=<span class="hljs-value">""</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">activity</span>
            <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"dji.sdk.SDKManager.DJIAoaControllerActivity"</span>
            <span class="hljs-attribute">android:theme</span>=<span class="hljs-value">"@android:style/Theme.Translucent"</span> &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">intent-filter</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">action</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.hardware.usb.action.USB_ACCESSORY_ATTACHED"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">intent-filter</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">meta-data</span>
                <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.hardware.usb.action.USB_ACCESSORY_ATTACHED"</span>
                <span class="hljs-attribute">android:resource</span>=<span class="hljs-value">"@xml/accessory_filter"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">activity</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- DJI SDK --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">activity</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">".FPVTutorialActivity"</span>
            <span class="hljs-attribute">android:theme</span>=<span class="hljs-value">"@android:style/Theme.NoTitleBar.Fullscreen"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">intent-filter</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">action</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.intent.action.MAIN"</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">category</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.intent.category.LAUNCHER"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">intent-filter</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">activity</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">application</span>&gt;</span>
</code></pre><p>The above code shows where to add the API Key for registration. The API Key can be applied as follows:</p><p>Register for an account at <a href="https://developer.dji.com/register">https://developer.dji.com/register</a>. Once registered, click on your name in the upper right corner. Click on ‘Mobile SDK’, then ‘Create APP’ and fill out the creation form. Type in your project’s package name in the ‘Identification Code’ field.</p><p>Fill in the <strong>android:value</strong> field with the APP KEY that you have applied for from <a href="http://developer.dji.com/en/user/apps">http://developer.dji.com/en/user/apps</a>.</p><p><img src="Images/appKeySS.png" alt="appKey"></p><h2 id="write-code-for-showing-video"><a name="write-code-for-showing-video" href="#write-code-for-showing-video"></a>Write Code for Showing Video</h2><h3 id="(1)-initiate-dji-sdk"><a name="(1)-initiate-dji-sdk" href="#(1)-initiate-dji-sdk"></a>(1) Initiate DJI SDK</h3><p>DJI SDK V3 uses class <strong>DJISDKManager</strong> to manage the SDK’s initiation, activation, and connection or disconnection to DJI’s product.</p><p>Before using DJI SDK V3, developers first need to initiate it by using function <strong>initSDKManager</strong> of class <strong>DJISDKManager</strong>. Interface <strong>DJISDKManagerCallback</strong> is used to listen to the SDK registration result and the connected product changing. An example code snippet is as follows, we recommend developers to implement these codes in the application of Android, which will be active when the mobile app is not closed. </p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>
@Override

public void onCreate() {

    super.onCreate();
    mHandler = new Handler(Looper.getMainLooper());
    //This is used to start SDK services and initiate SDK.
    DJISDKManager.getInstance().initSDKManager(this, mDJISDKManagerCallback); 

}

/**
 * When starting SDK services, an instance of interface DJISDKManager.DJISDKManagerCallback will be used to listen to 
 * the SDK Registration result and the product changing.
 */

private DJISDKManager.DJISDKManagerCallback mDJISDKManagerCallback = new DJISDKManager.DJISDKManagerCallback() {

    //Listens to the SDK registration result
    @Override

    public void onGetRegisteredResult(DJISDKError error) {
        if(error == DJISDKError.REGISTRATION_SUCCESS) {
            DJISDKManager.getInstance().startConnectionToProduct();
        } else {
            Handler handler = new Handler(Looper.getMainLooper());
            handler.post(new Runnable() {

                @Override
                public void run() {
                    Toast.makeText(getApplicationContext(), &quot;register sdk fails, check network is available&quot;, Toast.LENGTH_LONG).show();
                }
            });
        }
        Log.e(&quot;TAG&quot;, error.toString());
    }

    //Listens to the connected product changing, including two parts, component changing or product connection changing.

    @Override
    public void onProductChanged(DJIBaseProduct oldProduct, DJIBaseProduct newProduct) {

        mProduct = newProduct;
        if(mProduct != null) {
            mProduct.setDJIBaseProductListener(mDJIBaseProductListener);
        }
        notifyStatusChange();
    }
};

private DJIBaseProductListener mDJIBaseProductListener = new DJIBaseProductListener() {

    @Override
    public void onComponentChange(DJIComponentKey key, DJIBaseComponent oldComponent, DJIBaseComponent newComponent) {
        if(newComponent != null) {
            newComponent.setDJIComponentListener(mDJIComponentListener);
        }
        notifyStatusChange();
    }

    @Override
    public void onProductConnectivityChanged(boolean isConnected) {
        notifyStatusChange();
    }
};

private DJIComponentListener mDJIComponentListener = new DJIComponentListener() {

    @Override
    public void onComponentConnectivityChanged(boolean isConnected) {
        notifyStatusChange();
    }
};
</code></pre>">
<span class="hljs-annotation">@Override</span>

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">super</span>.onCreate();
    mHandler = <span class="hljs-keyword">new</span> Handler(Looper.getMainLooper());
    <span class="hljs-comment">//This is used to start SDK services and initiate SDK.</span>
    DJISDKManager.getInstance().initSDKManager(<span class="hljs-keyword">this</span>, mDJISDKManagerCallback); 

}

<span class="hljs-javadoc">/**
 * When starting SDK services, an instance of interface DJISDKManager.DJISDKManagerCallback will be used to listen to 
 * the SDK Registration result and the product changing.
 */</span>

<span class="hljs-keyword">private</span> DJISDKManager.DJISDKManagerCallback mDJISDKManagerCallback = <span class="hljs-keyword">new</span> DJISDKManager.DJISDKManagerCallback() {

    <span class="hljs-comment">//Listens to the SDK registration result</span>
    <span class="hljs-annotation">@Override</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onGetRegisteredResult</span><span class="hljs-params">(DJISDKError error)</span> </span>{
        <span class="hljs-keyword">if</span>(error == DJISDKError.REGISTRATION_SUCCESS) {
            DJISDKManager.getInstance().startConnectionToProduct();
        } <span class="hljs-keyword">else</span> {
            Handler handler = <span class="hljs-keyword">new</span> Handler(Looper.getMainLooper());
            handler.post(<span class="hljs-keyword">new</span> Runnable() {

                <span class="hljs-annotation">@Override</span>
                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
                    Toast.makeText(getApplicationContext(), <span class="hljs-string">"register sdk fails, check network is available"</span>, Toast.LENGTH_LONG).show();
                }
            });
        }
        Log.e(<span class="hljs-string">"TAG"</span>, error.toString());
    }

    <span class="hljs-comment">//Listens to the connected product changing, including two parts, component changing or product connection changing.</span>

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onProductChanged</span><span class="hljs-params">(DJIBaseProduct oldProduct, DJIBaseProduct newProduct)</span> </span>{

        mProduct = newProduct;
        <span class="hljs-keyword">if</span>(mProduct != <span class="hljs-keyword">null</span>) {
            mProduct.setDJIBaseProductListener(mDJIBaseProductListener);
        }
        notifyStatusChange();
    }
};

<span class="hljs-keyword">private</span> DJIBaseProductListener mDJIBaseProductListener = <span class="hljs-keyword">new</span> DJIBaseProductListener() {

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onComponentChange</span><span class="hljs-params">(DJIComponentKey key, DJIBaseComponent oldComponent, DJIBaseComponent newComponent)</span> </span>{
        <span class="hljs-keyword">if</span>(newComponent != <span class="hljs-keyword">null</span>) {
            newComponent.setDJIComponentListener(mDJIComponentListener);
        }
        notifyStatusChange();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onProductConnectivityChanged</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> isConnected)</span> </span>{
        notifyStatusChange();
    }
};

<span class="hljs-keyword">private</span> DJIComponentListener mDJIComponentListener = <span class="hljs-keyword">new</span> DJIComponentListener() {

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onComponentConnectivityChanged</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> isConnected)</span> </span>{
        notifyStatusChange();
    }
};
</code></pre><p>In the implementation of the Interface <strong>DJISDKManagerCallback</strong>, when the registration succeeds, call function <strong>startConnectionToProduct()</strong> to start connection with product; set the callback <strong>DJIBaseProductListener</strong> to listen to the connected product changing.</p><h3 id="(2)-obtain-or-initiate-the-djibaseproduct-object"><a name="(2)-obtain-or-initiate-the-djibaseproduct-object" href="#(2)-obtain-or-initiate-the-djibaseproduct-object"></a>(2) Obtain or initiate the DJIBaseProduct object</h3><p>DJI SDK V3 uses an instance of the class <strong>DJIBaseProduct</strong> to represent a DJI product. We recommend to use the following code to obtain or initiate the instance of DJIBaseProduct.</p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>
/**
 * This function is used to get the instance of DJIBaseProduct.
 * If no product is connected, it returns null.
 */

public static synchronized DJIBaseProduct getProductInstance() {
    if (null == mProduct) {
        mProduct = DJISDKManager.getInstance().getDJIProduct();
    }
    return mProduct;
}
</code></pre>">
<span class="hljs-javadoc">/**
 * This function is used to get the instance of DJIBaseProduct.
 * If no product is connected, it returns null.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> DJIBaseProduct <span class="hljs-title">getProductInstance</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == mProduct) {
        mProduct = DJISDKManager.getInstance().getDJIProduct();
    }
    <span class="hljs-keyword">return</span> mProduct;
}
</code></pre><p>When an instance of DJIBaseProduct is obtained or initiated, and is not null, the corresponding modules (DJICamera, DJIRemoteController, etc.) can be accessed by using <strong>DJIBaseProduct.getXXX()</strong> methods, e.g., <strong>mProduct.getCamera()</strong> to obtain an instance of the camera module.</p><h3 id="(3)-show-the-video-view-received-from-the-camera"><a name="(3)-show-the-video-view-received-from-the-camera" href="#(3)-show-the-video-view-received-from-the-camera"></a>(3) Show the video view received from the camera</h3><p>Developers need to implement the interface for receiving the raw video data (H.264 format) and the size of the data. DJI SDK V3 provides <strong>DJICodecManager</strong> for decoding the raw data. In the following sample code snippet, the raw video is put into an instance of <strong>DJICodecManager</strong>. After implementing the interface, use function <strong>setDJICameraReceivedVideoDataCallback</strong> to set it as the interface of DJICamera. </p><p>If developers want to show it on the screen of mobile devices, please add a TextureView as the UI for presenting the video. We recommend developers to refer to Google Developer’s official documentation on TextureView to learn more about it <a href="http://developer.android.com/intl/ko/reference/android/view/TextureView.html">http://developer.android.com/intl/ko/reference/android/view/TextureView.html</a>.</p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>
protected CameraReceivedVideoDataCallback mReceivedVideoDataCallBack = null;
protected DJIOnReceivedVideoCallback mOnReceivedVideoCallback = null;
private DJIBaseProduct mProduct = null;
private DJICamera mCamera = null;

// Codec for video live view
protected DJICodecManager mCodecManager = null;
protected TextView mConnectStatusTextView;

//Video Preview
protected TextureView mVideoSurface = null;  

@Override
protected void onCreate(Bundle savedInstanceState) {

    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_fpv);
    initUI();

    // The callback for receiving the raw H264 video data for camera live view
    mReceivedVideoDataCallBack = new CameraReceivedVideoDataCallback() {

        @Override

        public void onResult(byte[] videoBuffer, int size) {

            if(mCodecManager != null){
                // Send the raw H264 video data to codec manager for decoding
                mCodecManager.sendDataToDecoder(videoBuffer, size);
            }else {
                Log.e(TAG, &quot;mCodecManager is null&quot;);
            }
        }
    };  

    // The callback for receiving the raw video data from Airlink
    mOnReceivedVideoCallback = new DJIOnReceivedVideoCallback() {

        @Override
        public void onResult(byte[] videoBuffer, int size) {
            if(mCodecManager != null){
                // Send the raw H264 video data to codec manager for decoding
                mCodecManager.sendDataToDecoder(videoBuffer, size);
            } 
        }

    };
    ...        
}
</code></pre>">
<span class="hljs-keyword">protected</span> CameraReceivedVideoDataCallback mReceivedVideoDataCallBack = <span class="hljs-keyword">null</span>;
<span class="hljs-keyword">protected</span> DJIOnReceivedVideoCallback mOnReceivedVideoCallback = <span class="hljs-keyword">null</span>;
<span class="hljs-keyword">private</span> DJIBaseProduct mProduct = <span class="hljs-keyword">null</span>;
<span class="hljs-keyword">private</span> DJICamera mCamera = <span class="hljs-keyword">null</span>;

<span class="hljs-comment">// Codec for video live view</span>
<span class="hljs-keyword">protected</span> DJICodecManager mCodecManager = <span class="hljs-keyword">null</span>;
<span class="hljs-keyword">protected</span> TextView mConnectStatusTextView;

<span class="hljs-comment">//Video Preview</span>
<span class="hljs-keyword">protected</span> TextureView mVideoSurface = <span class="hljs-keyword">null</span>;  

<span class="hljs-annotation">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{

    <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
    setContentView(R.layout.activity_fpv);
    initUI();

    <span class="hljs-comment">// The callback for receiving the raw H264 video data for camera live view</span>
    mReceivedVideoDataCallBack = <span class="hljs-keyword">new</span> CameraReceivedVideoDataCallback() {

        <span class="hljs-annotation">@Override</span>

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResult</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] videoBuffer, <span class="hljs-keyword">int</span> size)</span> </span>{

            <span class="hljs-keyword">if</span>(mCodecManager != <span class="hljs-keyword">null</span>){
                <span class="hljs-comment">// Send the raw H264 video data to codec manager for decoding</span>
                mCodecManager.sendDataToDecoder(videoBuffer, size);
            }<span class="hljs-keyword">else</span> {
                Log.e(TAG, <span class="hljs-string">"mCodecManager is null"</span>);
            }
        }
    };  

    <span class="hljs-comment">// The callback for receiving the raw video data from Airlink</span>
    mOnReceivedVideoCallback = <span class="hljs-keyword">new</span> DJIOnReceivedVideoCallback() {

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResult</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] videoBuffer, <span class="hljs-keyword">int</span> size)</span> </span>{
            <span class="hljs-keyword">if</span>(mCodecManager != <span class="hljs-keyword">null</span>){
                <span class="hljs-comment">// Send the raw H264 video data to codec manager for decoding</span>
                mCodecManager.sendDataToDecoder(videoBuffer, size);
            } 
        }

    };
    ...        
}
</code></pre><p>The folowing is the definition of the Interface <strong>CameraReceivedVideoDataCallback</strong></p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>
public interface CameraReceivedVideoDataCallback {

    /** 
     * void onResult(byte[] videoBuffer, int size) - the receive video data callback.
     * 
     * @param videoBuffer The receive video data
     * @param size The size of video data
     */

    public void onResult(byte[] videoBuffer, int size);

}
</code></pre>">
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CameraReceivedVideoDataCallback</span> </span>{

    <span class="hljs-javadoc">/** 
     * void onResult(byte[] videoBuffer, int size) - the receive video data callback.
     * 
     *<span class="hljs-javadoctag"> @param</span> videoBuffer The receive video data
     *<span class="hljs-javadoctag"> @param</span> size The size of video data
     */</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResult</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] videoBuffer, <span class="hljs-keyword">int</span> size)</span></span>;

}
</code></pre><p>DJI SDK V3 provides a class <strong>DJICodecManager</strong> for hardware decoding the raw video data and showing the video in the TextureView.</p><p>We need to implement the interface <strong>SurfaceTextureListener</strong> and set it as the listener of the TextureView. <strong>SurfaceTextureListener</strong> can listen to when the surface texture is available, when it is destroyed, when its size is changed, when it is updated. The TextureView can initiate an instance of <strong>DJICodecManager</strong> when the surface texture is available.   </p><p>By putting the received video data from the Interface <strong>CameraReceivedVideoDataCallback</strong> to an instance of <strong>DJICodecManager</strong>, it can show the video on the screen.</p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>
//
@Override

public void onSurfaceTextureAvailable(SurfaceTexture surface, int width, int height) {
    Log.e(TAG,&quot;onSurfaceTextureAvailable&quot;);
    if (mCodecManager == null) {
        Log.e(TAG, &quot;mCodecManager is null 2&quot;);
        mCodecManager = new DJICodecManager(this, surface, width, height);
    }

}

//
@Override

public void onSurfaceTextureSizeChanged(SurfaceTexture surface, int width, int height) {
    Log.e(TAG,&quot;onSurfaceTextureSizeChanged&quot;);
}

//
@Override

public boolean onSurfaceTextureDestroyed(SurfaceTexture surface) {
    Log.e(TAG,&quot;onSurfaceTextureDestroyed&quot;);
    if (mCodecManager != null) {
        mCodecManager.cleanSurface();
        mCodecManager = null;
    }

    return false;
}

//

@Override

public void onSurfaceTextureUpdated(SurfaceTexture surface) {
    Log.e(TAG,&quot;onSurfaceTextureUpdated&quot;);
}
</code></pre>">
<span class="hljs-comment">//</span>
<span class="hljs-annotation">@Override</span>

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onSurfaceTextureAvailable</span><span class="hljs-params">(SurfaceTexture surface, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height)</span> </span>{
    Log.e(TAG,<span class="hljs-string">"onSurfaceTextureAvailable"</span>);
    <span class="hljs-keyword">if</span> (mCodecManager == <span class="hljs-keyword">null</span>) {
        Log.e(TAG, <span class="hljs-string">"mCodecManager is null 2"</span>);
        mCodecManager = <span class="hljs-keyword">new</span> DJICodecManager(<span class="hljs-keyword">this</span>, surface, width, height);
    }

}

<span class="hljs-comment">//</span>
<span class="hljs-annotation">@Override</span>

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onSurfaceTextureSizeChanged</span><span class="hljs-params">(SurfaceTexture surface, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height)</span> </span>{
    Log.e(TAG,<span class="hljs-string">"onSurfaceTextureSizeChanged"</span>);
}

<span class="hljs-comment">//</span>
<span class="hljs-annotation">@Override</span>

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">onSurfaceTextureDestroyed</span><span class="hljs-params">(SurfaceTexture surface)</span> </span>{
    Log.e(TAG,<span class="hljs-string">"onSurfaceTextureDestroyed"</span>);
    <span class="hljs-keyword">if</span> (mCodecManager != <span class="hljs-keyword">null</span>) {
        mCodecManager.cleanSurface();
        mCodecManager = <span class="hljs-keyword">null</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
}

<span class="hljs-comment">//</span>

<span class="hljs-annotation">@Override</span>

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onSurfaceTextureUpdated</span><span class="hljs-params">(SurfaceTexture surface)</span> </span>{
    Log.e(TAG,<span class="hljs-string">"onSurfaceTextureUpdated"</span>);
}
</code></pre><p>The interface <strong>CameraReceivedVideoDataCallback</strong> is set to the camera module for receiving the video data from the camera:</p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>
@Override

public void onResume() {
    Log.e(TAG, &quot;onResume&quot;);
    super.onResume();
    initPreviewer();
    updateTitleBar();

    if(mVideoSurface == null) {
        Log.e(TAG, &quot;mVideoSurface is null&quot;);
    }
}

...

private void initPreviewer() {

    try {
        mProduct = FPVTutorialApplication.getProductInstance();
    } catch (Exception exception) {
        mProduct = null;
    }

    if (null == mProduct || !mProduct.isConnected()) {

        mCamera = null;
        showToast(getString(R.string.disconnected));

    } else {

        if (null != mVideoSurface) {
            mVideoSurface.setSurfaceTextureListener(this);
        }

        if (!mProduct.getModel().equals(Model.UnknownAircraft)) {
            mCamera = mProduct.getCamera();
            if (mCamera != null){
                // Set the callback
                mCamera.setDJICameraReceivedVideoDataCallback(mReceivedVideoDataCallBack);   
            }

        } else {
            if (null != mProduct.getAirLink()) {
                if (null != mProduct.getAirLink().getLBAirLink()) {
                    // Set the callback
                    mProduct.getAirLink().getLBAirLink().setDJIOnReceivedVideoCallback(mOnReceivedVideoCallback);
                }

            }

        }

    }

}
</code></pre>">
<span class="hljs-annotation">@Override</span>

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResume</span><span class="hljs-params">()</span> </span>{
    Log.e(TAG, <span class="hljs-string">"onResume"</span>);
    <span class="hljs-keyword">super</span>.onResume();
    initPreviewer();
    updateTitleBar();

    <span class="hljs-keyword">if</span>(mVideoSurface == <span class="hljs-keyword">null</span>) {
        Log.e(TAG, <span class="hljs-string">"mVideoSurface is null"</span>);
    }
}

...

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initPreviewer</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">try</span> {
        mProduct = FPVTutorialApplication.getProductInstance();
    } <span class="hljs-keyword">catch</span> (Exception exception) {
        mProduct = <span class="hljs-keyword">null</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == mProduct || !mProduct.isConnected()) {

        mCamera = <span class="hljs-keyword">null</span>;
        showToast(getString(R.string.disconnected));

    } <span class="hljs-keyword">else</span> {

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mVideoSurface) {
            mVideoSurface.setSurfaceTextureListener(<span class="hljs-keyword">this</span>);
        }

        <span class="hljs-keyword">if</span> (!mProduct.getModel().equals(Model.UnknownAircraft)) {
            mCamera = mProduct.getCamera();
            <span class="hljs-keyword">if</span> (mCamera != <span class="hljs-keyword">null</span>){
                <span class="hljs-comment">// Set the callback</span>
                mCamera.setDJICameraReceivedVideoDataCallback(mReceivedVideoDataCallBack);   
            }

        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mProduct.getAirLink()) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mProduct.getAirLink().getLBAirLink()) {
                    <span class="hljs-comment">// Set the callback</span>
                    mProduct.getAirLink().getLBAirLink().setDJIOnReceivedVideoCallback(mOnReceivedVideoCallback);
                }

            }

        }

    }

}
</code></pre><h3 id="(4)-automatically-detect-the-type-of-connected-product"><a name="(4)-automatically-detect-the-type-of-connected-product" href="#(4)-automatically-detect-the-type-of-connected-product"></a>(4) Automatically Detect the Type of Connected Product</h3><p>DJI SDK V3 can automatically detect the type of connected product and use a broadcast receiver to announce it. The connected product changing is listened to by the function <strong>onProductChanged</strong> in the interface <strong>DJISDKManagerCallback</strong>, and interface <strong>DJIComponentListener</strong> listens to the changing of component (Camera, Remote Controller, etc.):</p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>
@Override

public void onCreate() {

    super.onCreate();
    mHandler = new Handler(Looper.getMainLooper());

    //This is used to start SDK services and initiate SDK.
    DJISDKManager.getInstance().initSDKManager(this, mDJISDKManagerCallback); 

}

/**
 * When starting SDK services, an instance of interface DJISDKManager.DJISDKManagerCallback will be used to listen to 
 * the SDK Registration result and the product changing.
 */

private DJISDKManager.DJISDKManagerCallback mDJISDKManagerCallback = new DJISDKManager.DJISDKManagerCallback() {

    //Listens to the SDK registration result

    @Override

    public void onGetRegisteredResult(DJISDKError error) {

        if(error == DJISDKError.REGISTRATION_SUCCESS) {

            DJISDKManager.getInstance().startConnectionToProduct();

        } else {

            Handler handler = new Handler(Looper.getMainLooper());
            handler.post(new Runnable() {

                @Override
                public void run() {
                    Toast.makeText(getApplicationContext(), &quot;register sdk fails, check network is available&quot;, Toast.LENGTH_LONG).show();
                }
            });
        }

        Log.e(&quot;TAG&quot;, error.toString());
    }

    //Listens to the connected product changing, including two parts, component changing or product connection changing.

    @Override

    public void onProductChanged(DJIBaseProduct oldProduct, DJIBaseProduct newProduct) {

        mProduct = newProduct;
        if(mProduct != null) {
            mProduct.setDJIBaseProductListener(mDJIBaseProductListener);
        }
        notifyStatusChange();
    }

};

private DJIBaseProductListener mDJIBaseProductListener = new DJIBaseProductListener() {

    @Override

    public void onComponentChange(DJIComponentKey key, DJIBaseComponent oldComponent, DJIBaseComponent newComponent) {

        if(newComponent != null) {
            newComponent.setDJIComponentListener(mDJIComponentListener);
        }

        notifyStatusChange();
    }

    @Override

    public void onProductConnectivityChanged(boolean isConnected) {
        notifyStatusChange();
    }
};

private DJIComponentListener mDJIComponentListener = new DJIComponentListener() {

    @Override

    public void onComponentConnectivityChanged(boolean isConnected) {
        notifyStatusChange();
    }

};

private void notifyStatusChange() {
    mHandler.removeCallbacks(updateRunnable);
    mHandler.postDelayed(updateRunnable, 500);
}

private Runnable updateRunnable = new Runnable() {

    @Override

    public void run() {
        Intent intent = new Intent(FLAG_CONNECTION_CHANGE);  
        sendBroadcast(intent);
    }

};
</code></pre>">
<span class="hljs-annotation">@Override</span>

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">super</span>.onCreate();
    mHandler = <span class="hljs-keyword">new</span> Handler(Looper.getMainLooper());

    <span class="hljs-comment">//This is used to start SDK services and initiate SDK.</span>
    DJISDKManager.getInstance().initSDKManager(<span class="hljs-keyword">this</span>, mDJISDKManagerCallback); 

}

<span class="hljs-javadoc">/**
 * When starting SDK services, an instance of interface DJISDKManager.DJISDKManagerCallback will be used to listen to 
 * the SDK Registration result and the product changing.
 */</span>

<span class="hljs-keyword">private</span> DJISDKManager.DJISDKManagerCallback mDJISDKManagerCallback = <span class="hljs-keyword">new</span> DJISDKManager.DJISDKManagerCallback() {

    <span class="hljs-comment">//Listens to the SDK registration result</span>

    <span class="hljs-annotation">@Override</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onGetRegisteredResult</span><span class="hljs-params">(DJISDKError error)</span> </span>{

        <span class="hljs-keyword">if</span>(error == DJISDKError.REGISTRATION_SUCCESS) {

            DJISDKManager.getInstance().startConnectionToProduct();

        } <span class="hljs-keyword">else</span> {

            Handler handler = <span class="hljs-keyword">new</span> Handler(Looper.getMainLooper());
            handler.post(<span class="hljs-keyword">new</span> Runnable() {

                <span class="hljs-annotation">@Override</span>
                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
                    Toast.makeText(getApplicationContext(), <span class="hljs-string">"register sdk fails, check network is available"</span>, Toast.LENGTH_LONG).show();
                }
            });
        }

        Log.e(<span class="hljs-string">"TAG"</span>, error.toString());
    }

    <span class="hljs-comment">//Listens to the connected product changing, including two parts, component changing or product connection changing.</span>

    <span class="hljs-annotation">@Override</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onProductChanged</span><span class="hljs-params">(DJIBaseProduct oldProduct, DJIBaseProduct newProduct)</span> </span>{

        mProduct = newProduct;
        <span class="hljs-keyword">if</span>(mProduct != <span class="hljs-keyword">null</span>) {
            mProduct.setDJIBaseProductListener(mDJIBaseProductListener);
        }
        notifyStatusChange();
    }

};

<span class="hljs-keyword">private</span> DJIBaseProductListener mDJIBaseProductListener = <span class="hljs-keyword">new</span> DJIBaseProductListener() {

    <span class="hljs-annotation">@Override</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onComponentChange</span><span class="hljs-params">(DJIComponentKey key, DJIBaseComponent oldComponent, DJIBaseComponent newComponent)</span> </span>{

        <span class="hljs-keyword">if</span>(newComponent != <span class="hljs-keyword">null</span>) {
            newComponent.setDJIComponentListener(mDJIComponentListener);
        }

        notifyStatusChange();
    }

    <span class="hljs-annotation">@Override</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onProductConnectivityChanged</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> isConnected)</span> </span>{
        notifyStatusChange();
    }
};

<span class="hljs-keyword">private</span> DJIComponentListener mDJIComponentListener = <span class="hljs-keyword">new</span> DJIComponentListener() {

    <span class="hljs-annotation">@Override</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onComponentConnectivityChanged</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> isConnected)</span> </span>{
        notifyStatusChange();
    }

};

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyStatusChange</span><span class="hljs-params">()</span> </span>{
    mHandler.removeCallbacks(updateRunnable);
    mHandler.postDelayed(updateRunnable, <span class="hljs-number">500</span>);
}

<span class="hljs-keyword">private</span> Runnable updateRunnable = <span class="hljs-keyword">new</span> Runnable() {

    <span class="hljs-annotation">@Override</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
        Intent intent = <span class="hljs-keyword">new</span> Intent(FLAG_CONNECTION_CHANGE);  
        sendBroadcast(intent);
    }

};
</code></pre><p>To listen to the changing product, please register a broadcast receiver,</p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>
// Register the broadcast receiver for receiving the device connection's changes.

IntentFilter filter = new IntentFilter();  
filter.addAction(FPVTutorialApplication.FLAG_CONNECTION_CHANGE);
registerReceiver(mReceiver, filter);
</code></pre>">
<span class="hljs-comment">// Register the broadcast receiver for receiving the device connection's changes.</span>

IntentFilter filter = <span class="hljs-keyword">new</span> IntentFilter();  
filter.addAction(FPVTutorialApplication.FLAG_CONNECTION_CHANGE);
registerReceiver(mReceiver, filter);
</code></pre><p>The above is an example for the explanation of the usage of DJI SDK V3’s APIs in showing video. We recommend developers to review the source code of the FPV tutorial project for a better understanding of the usage of DJI SDK V3’s APIs.</p><h2 id="connecting-to-your-aircraft"><a name="connecting-to-your-aircraft" href="#connecting-to-your-aircraft"></a>Connecting to your Aircraft</h2><p>After you have built and run the project successfully, you can now connect your mobile device to an aircraft to check the FPV. Follow the appropriate instructions for your specific aircraft model:</p><h3 id="1.-connecting-to-a-dji-inspire-1-or-phantom-3-professional/advanced:"><a name="1.-connecting-to-a-dji-inspire-1-or-phantom-3-professional/advanced:" href="#1.-connecting-to-a-dji-inspire-1-or-phantom-3-professional/advanced:"></a>1. Connecting to a DJI Inspire 1 or Phantom 3 Professional/Advanced:</h3><ol>
<li><p>Turn on your remote controller, then turn on your aircraft</p>
</li><li><p>Connect your mobile device to the remote controller using a USB cable. Tap your own app’s icon when the message window “Choose an app for the USB device” pops up.</p>
</li><li><p>Tap “OK” when the message window prompts “Allow the app to access the USB accessory”.</p>
</li><li><p>Tap “OK” when the activation alert displays.</p>
</li><li><p>You are ready to use the FPV View app. </p>
</li></ol><h2 id="checking-your-results"><a name="checking-your-results" href="#checking-your-results"></a>Checking your results</h2><p>If you can see the live video stream in the app, congratulations! You’ve succesfully implemented a First Person View!</p><p><img src="Images/runAppScreenShot.png" alt="runAppScreenShot"></p><h2 id="implementing-the-capture-function"><a name="implementing-the-capture-function" href="#implementing-the-capture-function"></a>Implementing the Capture Function</h2><p>The <strong>private void captureAction()</strong> function is used to take photos. In our source code, we implement a “Capture” button which calls this function whenever pressed.</p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>
// function for taking photo
private void captureAction(){

    CameraMode cameraMode = CameraMode.ShootPhoto;
   mCamera = mProduct.getCamera();
    mCamera.setCameraMode(cameraMode, new DJICompletionCallback(){

        @Override

        public void onResult(DJIError error)
        {
            if (error == null) {
                CameraShootPhotoMode photoMode = CameraShootPhotoMode.Single; // Set the camera capture mode as Single mode
                mCamera.startShootPhoto(photoMode, new DJICompletionCallback(){

                    @Override
                    public void onResult(DJIError error)
                    {
                        if (error == null) {
                            showToast(&quot;take photo: success&quot;);
                        }else {
                            showToast(error.getDescription());
                        }              
                    }

                }); // Execute the startShootPhoto API

            } else {
               showToast(error.getDescription());
            }

        }

    });

}
</code></pre>">
<span class="hljs-comment">// function for taking photo</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">captureAction</span><span class="hljs-params">()</span></span>{

    CameraMode cameraMode = CameraMode.ShootPhoto;
   mCamera = mProduct.getCamera();
    mCamera.setCameraMode(cameraMode, <span class="hljs-keyword">new</span> DJICompletionCallback(){

        <span class="hljs-annotation">@Override</span>

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResult</span><span class="hljs-params">(DJIError error)</span>
        </span>{
            <span class="hljs-keyword">if</span> (error == <span class="hljs-keyword">null</span>) {
                CameraShootPhotoMode photoMode = CameraShootPhotoMode.Single; <span class="hljs-comment">// Set the camera capture mode as Single mode</span>
                mCamera.startShootPhoto(photoMode, <span class="hljs-keyword">new</span> DJICompletionCallback(){

                    <span class="hljs-annotation">@Override</span>
                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResult</span><span class="hljs-params">(DJIError error)</span>
                    </span>{
                        <span class="hljs-keyword">if</span> (error == <span class="hljs-keyword">null</span>) {
                            showToast(<span class="hljs-string">"take photo: success"</span>);
                        }<span class="hljs-keyword">else</span> {
                            showToast(error.getDescription());
                        }              
                    }

                }); <span class="hljs-comment">// Execute the startShootPhoto API</span>

            } <span class="hljs-keyword">else</span> {
               showToast(error.getDescription());
            }

        }

    });

}
</code></pre><p>That was a lot of code we just threw at you, so let’s break it down.</p><p>The first thing we need to do is define a CameraMode enum, which we will use to set the mode of the camera onboard our DJI Drone.</p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>CameraMode cameraMode = CameraMode.ShootPhoto;
</code></pre>">CameraMode cameraMode = CameraMode.ShootPhoto;
</code></pre><p>The reason we defined this enum ‘cameraMode’ was so that we could pass it as a parameter for the <strong>setCameraMode()</strong> function that we are about to call. <strong>setCameraMode()</strong> sets the mode of the DJI drone’s camera (Capture Mode, Playback Mode, Record Mode etc.). <strong>setCameraMode()</strong> takes in two parameters:</p><p><strong>setCameraMode(CameraMode mode, final DJICompletionCallback callback)</strong></p><p>The first parameter, a CameraMode enum, tells the function what mode to set the camera to. In this case, we tell it to set the camera to Capture Mode.</p><p>The second parameter is a callback function, which is run after <strong>setCameraMode()</strong> attempts to set the camera mode. The callback function is reproduced, in brief, below.</p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>
new DJICompletionCallback(){
        @Override

        public void onResult(DJIError error)
        {
            if (error == null) {
                showToast(&quot;take photo: success&quot;);
            }else {
                showToast(error.getDescription());
            }              
        }
 }
</code></pre>">
<span class="hljs-keyword">new</span> DJICompletionCallback(){
        <span class="hljs-annotation">@Override</span>

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResult</span><span class="hljs-params">(DJIError error)</span>
        </span>{
            <span class="hljs-keyword">if</span> (error == <span class="hljs-keyword">null</span>) {
                showToast(<span class="hljs-string">"take photo: success"</span>);
            }<span class="hljs-keyword">else</span> {
                showToast(error.getDescription());
            }              
        }
 }
</code></pre><p>The callback function takes in a confirmation signal from the drone, in the form of a DJIError object ‘error’. If the error code given by ‘error’ is null, then the code to take the photo executed successfully. Else, a handler will show an appropriate error message depending on the error code.</p><p>Within the callback function we have code to tell the drone to take a photo.</p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>
    if (error == null) {

        CameraShootPhotoMode photoMode = CameraShootPhotoMode.Single; // Set the camera capture mode as Single mode
        mCamera.startShootPhoto(photoMode, new DJICompletionCallback(){

            @Override
            public void onResult(DJIError error)
            {
                if (error == null) {
                    showToast(&quot;take photo: success&quot;);
                }else {
                    showToast(error.getDescription());
                }              
            }

        }); // Execute the startShootPhoto API

    } else {
       showToast(error.getDescription());
    }
</code></pre>">
    <span class="hljs-keyword">if</span> (error == <span class="hljs-keyword">null</span>) {

        CameraShootPhotoMode photoMode = CameraShootPhotoMode.Single; <span class="hljs-comment">// Set the camera capture mode as Single mode</span>
        mCamera.startShootPhoto(photoMode, <span class="hljs-keyword">new</span> DJICompletionCallback(){

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResult</span><span class="hljs-params">(DJIError error)</span>
            </span>{
                <span class="hljs-keyword">if</span> (error == <span class="hljs-keyword">null</span>) {
                    showToast(<span class="hljs-string">"take photo: success"</span>);
                }<span class="hljs-keyword">else</span> {
                    showToast(error.getDescription());
                }              
            }

        }); <span class="hljs-comment">// Execute the startShootPhoto API</span>

    } <span class="hljs-keyword">else</span> {
       showToast(error.getDescription());
    }
</code></pre><p>If this code looks familiar, it’s because it follows a structure almost identical to the larger function it is a part of! First we create a CameraShootPhotoMode enum called ‘photoMode’. When the drone takes a photo, this enum instructs the drone whether it should take a single photo, a burst of photos, or a continuous stream of photos. For this example we’ll be taking a single photo at a time.</p><p>The <strong>startShootPhoto()</strong> method tells the drone’s camera to take a photo. Just like the <strong>setCameraMode()</strong> function, it takes in an enum and a callback function. We’ve just gone over the enum variable it takes in.</p><p>The callback function uses a handler to display a message giving an error code and an error description after the drone’s camera attempts to take a photo. If a photo has successfully been taken, this message will confirm it.</p><p>And that’s it! Add a “Capture” button into your app which calls this method, and give it a go!</p><h2 id="implement-the-recording-function"><a name="implement-the-recording-function" href="#implement-the-recording-function"></a>Implement the Recording Function</h2><p>The <strong>recordAction()</strong> method is almost identical to the <strong>captureAction()</strong> method we just implemented, with just a few key differences! Take a quick look at the code below:</p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>
// function for starting recording

private void recordAction(){

    CameraMode cameraMode = CameraMode.RecordVideo;
    mCamera = mProduct.getCamera();
    mCamera.setCameraMode(cameraMode, new DJICompletionCallback(){

        @Override
        public void onResult(DJIError error)
        {
            if (error == null) {
                mCamera.startRecordVideo(new DJICompletionCallback(){

                    @Override

                    public void onResult(DJIError error)
                    {
                        if (error == null) {
                            showToast(&quot;Record video: success&quot;);
                            handlerTimer.postDelayed(runnable, TIME); // Start the timer for recording
                        }else {
                            showToast(error.getDescription());
                        }              
                    }

                }); // Execute the startShootPhoto API

            } else {
               showToast(error.getDescription());
            }
        }
    });

}
</code></pre>">
<span class="hljs-comment">// function for starting recording</span>

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">recordAction</span><span class="hljs-params">()</span></span>{

    CameraMode cameraMode = CameraMode.RecordVideo;
    mCamera = mProduct.getCamera();
    mCamera.setCameraMode(cameraMode, <span class="hljs-keyword">new</span> DJICompletionCallback(){

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResult</span><span class="hljs-params">(DJIError error)</span>
        </span>{
            <span class="hljs-keyword">if</span> (error == <span class="hljs-keyword">null</span>) {
                mCamera.startRecordVideo(<span class="hljs-keyword">new</span> DJICompletionCallback(){

                    <span class="hljs-annotation">@Override</span>

                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResult</span><span class="hljs-params">(DJIError error)</span>
                    </span>{
                        <span class="hljs-keyword">if</span> (error == <span class="hljs-keyword">null</span>) {
                            showToast(<span class="hljs-string">"Record video: success"</span>);
                            handlerTimer.postDelayed(runnable, TIME); <span class="hljs-comment">// Start the timer for recording</span>
                        }<span class="hljs-keyword">else</span> {
                            showToast(error.getDescription());
                        }              
                    }

                }); <span class="hljs-comment">// Execute the startShootPhoto API</span>

            } <span class="hljs-keyword">else</span> {
               showToast(error.getDescription());
            }
        }
    });

}
</code></pre><p>Notice that the cameraMode enum has been set as <strong>RecordVideo</strong> because this time we want the camera to record.</p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>
// Set the cameraMode as Camera_Record_Mode.
CameraMode cameraMode = CameraMode.RecordVideo;
</code></pre>">
<span class="hljs-comment">// Set the cameraMode as Camera_Record_Mode.</span>
CameraMode cameraMode = CameraMode.RecordVideo;
</code></pre><p>Additionally, within our callback function, we call <strong>startRecordVideo()</strong> instead of <strong>startShootPhoto()</strong>. <strong>startRecordVideo()</strong> only takes in one parameter, a callback function. It does not take in an enum as <strong>startShootPhoto()</strong> does, as there is only one recording mode.</p><h2 id="implement-the-stopping-recording-function"><a name="implement-the-stopping-recording-function" href="#implement-the-stopping-recording-function"></a>Implement the Stopping Recording Function</h2><p>Once the camera starts recording, we need some way to tell it to stop! That’s where <strong>stopRecord()</strong> comes in. The code below should look quite familiar to you by now:</p><pre class="java hljs"><code class="java" data-origin="<pre><code class=&quot;java&quot;>
// function for stopping recording
private void stopRecord(){

    mCamera = mProduct.getCamera();
    mCamera.stopRecordVideo(new DJICompletionCallback(){

    @Override

    public void onResult(DJIError error)
    {    

        if(error == null) {
            showToast(&quot;Stop recording: success&quot;);
        }else {
            showToast(error.getDescription());
        }

        handlerTimer.removeCallbacks(runnable); // Start the timer for recording
        i = 0; // Reset the timer for recording
    }

    });
}
</code></pre>">
<span class="hljs-comment">// function for stopping recording</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stopRecord</span><span class="hljs-params">()</span></span>{

    mCamera = mProduct.getCamera();
    mCamera.stopRecordVideo(<span class="hljs-keyword">new</span> DJICompletionCallback(){

    <span class="hljs-annotation">@Override</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResult</span><span class="hljs-params">(DJIError error)</span>
    </span>{    

        <span class="hljs-keyword">if</span>(error == <span class="hljs-keyword">null</span>) {
            showToast(<span class="hljs-string">"Stop recording: success"</span>);
        }<span class="hljs-keyword">else</span> {
            showToast(error.getDescription());
        }

        handlerTimer.removeCallbacks(runnable); <span class="hljs-comment">// Start the timer for recording</span>
        i = <span class="hljs-number">0</span>; <span class="hljs-comment">// Reset the timer for recording</span>
    }

    });
}
</code></pre><p>You can now add a ‘Record’ and ‘Stop Recording’ button to your app, and have them call <strong>recordAction()</strong> and <strong>stopRecord()</strong> respectively. Build and run the project, and it should look something like the screenshot below:</p><p><img src="Images/recordVideo.png" alt="recordVideoScreenShot"></p><p>Congratulations! Your Aerial First Person View Android app is complete, capable of viewing your DJI Drone’s video feed, as well as remotely taking picture and videos!</p><h2 id="viewing-your-images"><a name="viewing-your-images" href="#viewing-your-images"></a>Viewing your Images</h2><p>Unfortunately, this tutorial does not include guidance on viewing photos and videos onboard your DJI Drone’s SD card. However, if you would like to see the pictures and videos you took through your brand new app, you can download DJI GO App, found here:</p><p><a href="https://play.google.com/store/apps/details?id=dji.pilot&amp;hl=en">https://play.google.com/store/apps/details?id=dji.pilot&amp;hl=en</a></p><p>Alternatively, you can search for the app in the Google Play Store under the name ‘DJI GO’. </p><h2 id="summary"><a name="summary" href="#summary"></a>Summary</h2><p>You’ve come a long way in this tutorial: you’ve learned how to use the DJI Mobile SDK to show the FPV view of the aircraft’s camera and control the camera of a DJI platform. These features, <strong>Capture</strong> and <strong>Record</strong> are the most basic and common features in a typical drone mobile app. However, if you want to create a drone app that is more fancy, you still have a long way to go. More advanced features would include previewing the photo and video in the SD Card, showing the OSD of the aircraft and so on. </p><p>Hope you enjoyed this tutorial, stay tuned for our next one!</p>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
